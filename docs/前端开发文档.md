# å›½é£è½»ç©åˆé›† - å‰ç«¯å¼€å‘æ–‡æ¡£

> ç‰ˆæœ¬ï¼šv1.0  
> æ›´æ–°æ—¶é—´ï¼š2026-02-12  
> é€‚ç”¨èŒƒå›´ï¼šå°ç¨‹åºå‰ç«¯å¼€å‘

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
minigame/
â”œâ”€â”€ pages/              # é¡µé¢ç›®å½•
â”‚   â”œâ”€â”€ index/         # é¦–é¡µï¼ˆæ¸¸æˆé€‰æ‹©ï¼‰
â”‚   â”œâ”€â”€ index-html/    # é¦–é¡µHTMLç‰ˆï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰
â”‚   â”œâ”€â”€ game/          # æ¸¸æˆé¡µé¢
â”‚   â””â”€â”€ result/        # ç»“ç®—é¡µé¢
â”œâ”€â”€ gameLogic/         # æ¸¸æˆé€»è¾‘
â”‚   â”œâ”€â”€ wordFind.js    # æ‰¾æˆè¯­
â”‚   â”œâ”€â”€ charDiff.js    # æ±‰å­—æ‰¾ä¸åŒ
â”‚   â””â”€â”€ poetryConnect.js # è¯—è¯è¿çº¿
â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ canvas.js      # Canvasç»˜åˆ¶å·¥å…·
â”‚   â”œâ”€â”€ timer.js       # å€’è®¡æ—¶ç»„ä»¶
â”‚   â”œâ”€â”€ api.js         # APIè¯·æ±‚å°è£…
â”‚   â””â”€â”€ ad.js          # å¹¿å‘Šé…ç½®
â”œâ”€â”€ data/              # é™æ€æ•°æ®
â”œâ”€â”€ app.js             # å°ç¨‹åºå…¥å£
â”œâ”€â”€ app.json           # å…¨å±€é…ç½®
â””â”€â”€ game.js            # æ¸¸æˆçŠ¶æ€ç®¡ç†
```

---

## ğŸ® ä¸‰ä¸ªæ ¸å¿ƒæ¸¸æˆ

### 1. æ‰¾æˆè¯­ (wordFind)

#### æ¸¸æˆæœºåˆ¶
- å±å¹•æ˜¾ç¤ºè‹¥å¹²æ±‰å­—ï¼ˆæ­£ç¡®æˆè¯­ + å¹²æ‰°å­—ï¼‰
- ç©å®¶ä¾æ¬¡ç‚¹å‡» 4 ä¸ªå­—ç»„æˆæˆè¯­
- é€‰å¯¹ 4 ä¸ªå­—åè‡ªåŠ¨è·³è½¬ç»“ç®—é¡µ

#### éš¾åº¦é…ç½®
```javascript
// gameLogic/wordFind.js
var DIFFICULTY_CONFIG = {
  easy:   { cols: 4, rows: 4, cellSize: 72 },   // 16 å­—ï¼Œç®€å•
  normal: { cols: 5, rows: 5, cellSize: 64 },   // 25 å­—ï¼Œä¸€èˆ¬
  hard:   { cols: 5, rows: 7, cellSize: 52 },   // 35 å­—ï¼Œå›°éš¾
};
```

#### æ—¶é—´é™åˆ¶
- ç®€å•ï¼š20 ç§’
- ä¸€èˆ¬ï¼š30 ç§’
- å›°éš¾ï¼š40 ç§’

#### å…³é”®æ–¹æ³•
```javascript
// åˆå§‹åŒ–çŸ©é˜µ
WordFindLogic.prototype.initMatrix = function()

// ç‚¹å‡»æ ¼å­
WordFindLogic.prototype.tapCell = function(row, col)
// è¿”å›: { success, isComplete, isFull, isCorrect }

// ç»˜åˆ¶æ¸¸æˆç•Œé¢
WordFindLogic.prototype.draw = function(ctx, offsetX, offsetY)

// åˆ¤æ–­ç‚¹å‡»ä½ç½®
WordFindLogic.prototype.getCellByPoint = function(x, y)
```

---

### 2. æ±‰å­—æ‰¾ä¸åŒ (charDiff)

#### æ¸¸æˆæœºåˆ¶
- å¤§é‡ç›¸åŒæ±‰å­—ä¸­æœ‰ 1 ä¸ªä¸åŒ
- ç©å®¶ç‚¹å‡»ä¸åŒçš„å­—
- æ‰¾åˆ°åç«‹å³è·³è½¬ç»“ç®—é¡µ

#### éš¾åº¦é…ç½®
```javascript
// gameLogic/charDiff.js
var DIFFICULTY_CONFIG = {
  easy:   { cols: 3, rows: 3, cellSize: 100 },  // 9 å­—ï¼Œå·®å¼‚æ˜æ˜¾
  normal: { cols: 4, rows: 4, cellSize: 80 },   // 16 å­—ï¼Œç¬”ç”»å·®å¼‚å°
  hard:   { cols: 5, rows: 5, cellSize: 64 },   // 25 å­—ï¼Œæåº¦ç›¸ä¼¼
};
```

#### æ—¶é—´é™åˆ¶
- ç®€å•ï¼š20 ç§’
- ä¸€èˆ¬ï¼š25 ç§’
- å›°éš¾ï¼š30 ç§’

#### å…³é”®æ–¹æ³•
```javascript
// åˆå§‹åŒ–çŸ©é˜µ
CharDiffLogic.prototype.initMatrix = function()

// ç‚¹å‡»æ ¼å­
CharDiffLogic.prototype.tap = function(row, col)
// è¿”å›: { hit, wrongCount }

// ç»˜åˆ¶æ¸¸æˆç•Œé¢
CharDiffLogic.prototype.draw = function(ctx, offsetX, offsetY)
```

---

### 3. è¯—è¯è¿çº¿ (poetryConnect)

#### æ¸¸æˆæœºåˆ¶
- å·¦å³ä¸¤åˆ—è¯—å¥ï¼ŒåŒ¹é…ä¸Šä¸‹å¥
- ç‚¹å‡»å·¦è¾¹ â†’ ç‚¹å‡»å³è¾¹å½¢æˆè¿çº¿
- å…¨éƒ¨è¿å¯¹åç«‹å³è·³è½¬ç»“ç®—é¡µ

#### éš¾åº¦é…ç½®
```javascript
// gameLogic/poetryConnect.js
// ç®€å•ï¼š3 å¯¹
// ä¸€èˆ¬ï¼š5 å¯¹
// å›°éš¾ï¼š8 å¯¹
```

#### æ—¶é—´é™åˆ¶
- ç®€å•ï¼š30 ç§’
- ä¸€èˆ¬ï¼š45 ç§’
- å›°éš¾ï¼š70 ç§’

#### å…³é”®æ–¹æ³•
```javascript
// åˆå§‹åŒ–è¯—å¥
PoetryConnectLogic.prototype.initItems = function()

// ç‚¹å‡»è¯—å¥
PoetryConnectLogic.prototype.tapItem = function(id)
// è¿”å›: { isComplete }

// ç»˜åˆ¶æ¸¸æˆç•Œé¢
PoetryConnectLogic.prototype.draw = function(ctx, offsetX, offsetY)
```

---

## ğŸ¨ Canvas ç»˜åˆ¶ç³»ç»Ÿ

### æ ¸å¿ƒå·¥å…·å‡½æ•° (utils/canvas.js)

#### 1. ç»˜åˆ¶åœ†è§’çŸ©å½¢
```javascript
roundRect(ctx, x, y, w, h, r)
```

#### 2. ç»˜åˆ¶æ¸å˜å¡ç‰‡
```javascript
drawGradientCard(ctx, x, y, w, h, r, color1, color2)
```

#### 3. ç»˜åˆ¶æŒ‰é’®
```javascript
drawButton(ctx, x, y, w, h, text, options)
```

#### 4. ç»˜åˆ¶èƒŒæ™¯
```javascript
drawInkBg(ctx, w, h)  // æ°´å¢¨èƒŒæ™¯
```

#### 5. ä¸»é¢˜è‰²é…ç½®
```javascript
const THEME = {
  moHei: '#2C1810',      // å¢¨é»‘
  zhuSha: '#C82506',     // æœ±ç ‚çº¢
  danJin: '#D4A84B',     // æ·¡é‡‘
  nuanHui: '#8B6F47',    // æš–ç°
};
```

---

## â±ï¸ å€’è®¡æ—¶ç³»ç»Ÿ (utils/timer.js)

### æ—¶é—´é…ç½®
```javascript
var TIME_CONFIG = {
  wordFind:        { easy: 20, normal: 30, hard: 40 },
  charDiff:        { easy: 20, normal: 25, hard: 30 },
  poetryConnect:   { easy: 30, normal: 45, hard: 70 },
};
```

### ä½¿ç”¨æ–¹æ³•
```javascript
// åˆ›å»ºå€’è®¡æ—¶
this.timer = new GameTimer(totalSec, 
  function(remainingFloat) {
    // æ¯å¸§å›è°ƒ
    self.timerRemaining = remainingFloat;
    self.draw();
  }, 
  function() {
    // æ—¶é—´åˆ°å›è°ƒ
    self.goResult(false);
  }
);

// å¯åŠ¨
this.timer.start();

// åœæ­¢
this.timer.stop();
```

---

## ğŸ”— API è¯·æ±‚ (utils/api.js)

### è·å–å…³å¡æ•°æ®
```javascript
api.getLevelData(gameId, difficulty, level, openid)
  .then(res => {
    // res.levelData - å…³å¡æ•°æ®
    // res.answer - ç­”æ¡ˆ
  })
  .catch(err => {
    // é”™è¯¯å¤„ç†
  });
```

### ä¸Šä¼ åˆ†æ•°
```javascript
api.uploadScore(gameId, level, score, openid)
  .then(res => {
    // ä¸Šä¼ æˆåŠŸ
  });
```

---

## ğŸ“± é¡µé¢å¼€å‘è§„èŒƒ

### 1. é¦–é¡µ (pages/index/)

#### Canvas ç‰ˆæœ¬ï¼ˆå½“å‰ä½¿ç”¨ï¼‰
- ä½¿ç”¨ Canvas 2D ç»˜åˆ¶å¡ç‰‡
- æ‰‹åŠ¨å¤„ç†è§¦æ‘¸äº‹ä»¶
- æ–‡ä»¶ï¼š`index.js`, `index.wxml`, `index.wxss`

#### HTML ç‰ˆæœ¬ï¼ˆå¤‡é€‰ï¼‰
- ä½¿ç”¨ WXML + CSS å®ç°
- å¤©ç„¶æ”¯æŒç‚¹å‡»äº‹ä»¶
- æ–‡ä»¶ï¼š`index-html/index-html.js` ç­‰

**æ¨è**ï¼šHTML ç‰ˆæœ¬æ›´æ˜“ç»´æŠ¤

---

### 2. æ¸¸æˆé¡µé¢ (pages/game/)

#### å…³é”®ç”Ÿå‘½å‘¨æœŸ
```javascript
onLoad(options) {
  // è·å– gameId å’Œ level
  this.gameId = options.gameId || 'wordFind';
  this.level = parseInt(options.level, 10) || 1;
}

onReady() {
  // åˆå§‹åŒ– Canvas
  this.initCanvas();
  // åŠ è½½å…³å¡æ•°æ®
  this.loadLevelAndStart();
}
```

#### Canvas åˆå§‹åŒ–
```javascript
initCanvas() {
  const query = wx.createSelectorQuery().in(this);
  query.select('#gameCanvas')
    .fields({ node: true, size: true })
    .exec((res) => {
      const canvas = res[0].node;
      const ctx = canvas.getContext('2d');
      const dpr = wx.getSystemInfoSync().pixelRatio || 2;
      canvas.width = width * dpr;
      canvas.height = height * dpr;
      ctx.scale(dpr, dpr);
      this.ctx = ctx;
      this.draw();
    });
}
```

#### è§¦æ‘¸äº‹ä»¶å¤„ç†
```javascript
handleTap(x, y) {
  // 1. æ£€æµ‹æŒ‰é’®ç‚¹å‡»ï¼ˆæç¤ºæŒ‰é’®ï¼‰
  // 2. æ£€æµ‹æ¸¸æˆåŒºåŸŸç‚¹å‡»
  // 3. æ ¹æ®æ¸¸æˆç±»å‹è°ƒç”¨å¯¹åº” logic æ–¹æ³•
}
```

#### ç»˜åˆ¶æµç¨‹
```javascript
draw() {
  // 1. ç»˜åˆ¶èƒŒæ™¯
  drawInkBg(ctx, w, h);
  
  // 2. ç»˜åˆ¶æ ‡é¢˜æ ï¼ˆæ¸¸æˆå + å…³å¡æ•°ï¼‰
  // 3. ç»˜åˆ¶å€’è®¡æ—¶è¿›åº¦æ¡
  // 4. ç»˜åˆ¶æ¸¸æˆå†…å®¹ï¼ˆè°ƒç”¨ logic.drawï¼‰
  // 5. ç»˜åˆ¶æç¤ºæŒ‰é’®
}
```

---

### 3. ç»“ç®—é¡µé¢ (pages/result/)

#### å‚æ•°æ¥æ”¶
```javascript
onLoad(options) {
  this.gameId = options.gameId;
  this.level = parseInt(options.level, 10);
  this.score = parseInt(options.score, 10);
  this.success = options.success === '1';
  this.remaining = parseFloat(options.remaining);
  this.total = parseFloat(options.total);
}
```

#### è·³è½¬ä¸‹ä¸€å…³
```javascript
goNextLevel() {
  wx.redirectTo({
    url: `/pages/game/game?gameId=${this.gameId}&level=${this.level + 1}`
  });
}
```

---

## ğŸ¯ å…³é”®äº¤äº’é€»è¾‘

### è‡ªåŠ¨è·³è½¬è§„åˆ™

æ‰€æœ‰æ¸¸æˆå®Œæˆå**ç«‹å³è·³è½¬**ç»“ç®—é¡µï¼ˆ0 å»¶è¿Ÿï¼‰ï¼š

```javascript
// æ‰¾æˆè¯­ï¼šé€‰æ»¡ 4 ä¸ªå­—å
if (ret && ret.isFull) {
  if (ret.isCorrect) {
    self.goResult(true);  // æ­£ç¡®ç«‹å³è·³è½¬
  } else {
    // é”™è¯¯æç¤º + è‡ªåŠ¨æ¸…ç©º
    wx.showToast({ title: 'ç­”æ¡ˆä¸å¯¹ï¼Œå†è¯•è¯•', icon: 'none' });
    setTimeout(() => {
      self.logic.selected = [];
      self.draw();
    }, 1500);
  }
}

// æ±‰å­—æ‰¾ä¸åŒï¼šæ‰¾åˆ°ç­”æ¡ˆ
if (ret.hit) {
  self.goResult(true);
}

// è¯—è¯è¿çº¿ï¼šå…¨éƒ¨è¿å¯¹
if (res.isComplete) {
  self.goResult(true);
}
```

---

## ğŸ› å¸¸è§é—®é¢˜è§£å†³

### 1. Canvas æ¨¡ç³Šé—®é¢˜
```javascript
// è§£å†³æ–¹æ¡ˆï¼šè®¾ç½®æ­£ç¡®çš„ DPR
const dpr = wx.getSystemInfoSync().pixelRatio || 2;
canvas.width = width * dpr;
canvas.height = height * dpr;
ctx.scale(dpr, dpr);

// CSS å­—ä½“æŠ—é”¯é½¿
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
```

### 2. è§¦æ‘¸äº‹ä»¶åç§»
```javascript
// ç¡®ä¿ draw() å’Œ handleTap() ä¸­çš„åæ ‡è®¡ç®—ä¸€è‡´
// areaTop å¿…é¡»ç›¸åŒ
const areaTop = titleBarH + 28;

// nativeW å’Œ nativeH å¿…é¡»åŠ¨æ€è®¡ç®—
if (this.logic && this.gameId === 'wordFind') {
  nativeW = this.logic.cols * (this.logic.cellSize + 6) - 6;
  nativeH = this.logic.rows * (this.logic.cellSize + 6) - 6;
}
```

### 3. åæ ‡è½¬æ¢
```javascript
// å±å¹•åæ ‡ â†’ æ¸¸æˆåŒºåŸŸæœ¬åœ°åæ ‡
const scale = Math.min(availW / nativeW, maxH / totalNativeH, 1.15);
const offsetX = (w - nativeW * scale) / 2;
const offsetY = areaTop + extraTop * scale;
const localX = (x - offsetX) / scale;
const localY = (y - offsetY) / scale;
```

---

## ğŸ¨ æ ·å¼è§„èŒƒ

### å›½é£é…è‰²
```css
/* ä¸»è‰²è°ƒ */
--color-primary: #C82506;    /* æœ±ç ‚çº¢ */
--color-secondary: #D4A84B;  /* æ·¡é‡‘ */
--color-text: #2C1810;       /* å¢¨é»‘ */
--color-bg: #F5E9D6;         /* ç±³è‰²èƒŒæ™¯ */
--color-gray: #8B6F47;       /* æš–ç° */
```

### å­—ä½“è§„èŒƒ
```css
/* æ ‡é¢˜ */
font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
font-weight: bold;
font-size: 18px;

/* æ­£æ–‡ */
font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
font-size: 14px;

/* Emoji */
font-family: 'Apple Color Emoji', 'Segoe UI Emoji', sans-serif;
```

---

## ğŸ”§ å¼€å‘è°ƒè¯•

### å¯ç”¨è°ƒè¯•æ—¥å¿—
```javascript
// åœ¨å„å…³é”®æ–¹æ³•ä¸­æ·»åŠ  console.log
console.log('[Game] draw() å¼€å§‹', { w, h });
console.log('[Game] onTouchEnd åæ ‡:', { x, y });
console.log('[WordFind] ç‚¹å‡»å‘½ä¸­:', { cell: cell.char });
```

### ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·
1. æ‰“å¼€è°ƒè¯•å™¨ï¼ˆå³ä¾§é¢æ¿ï¼‰
2. Console æŸ¥çœ‹æ—¥å¿—
3. Network æŸ¥çœ‹ API è¯·æ±‚
4. Storage æŸ¥çœ‹æœ¬åœ°å­˜å‚¨

---

## ğŸ“¦ ä¾èµ–ç®¡ç†

### å°ç¨‹åºåŸºç¡€åº“
- æœ€ä½ç‰ˆæœ¬ï¼š2.0.0
- æ¨èç‰ˆæœ¬ï¼š2.28.0+

### ç¬¬ä¸‰æ–¹ä¾èµ–
æ— ï¼ˆçº¯åŸç”Ÿå°ç¨‹åºå¼€å‘ï¼‰

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. Canvas ç»˜åˆ¶ä¼˜åŒ–
- é¿å…å…¨å±é‡ç»˜ï¼Œåªæ›´æ–°å˜åŒ–åŒºåŸŸ
- å€’è®¡æ—¶è¿›åº¦æ¡å•ç‹¬é‡ç»˜ï¼ˆä¸åŒ…å«ç§’æ•°æ–‡å­—ï¼‰

### 2. å›¾ç‰‡èµ„æºä¼˜åŒ–
- ä½¿ç”¨ WebP æ ¼å¼
- å‹ç¼©å›¾ç‰‡å¤§å°
- æ‡’åŠ è½½éé¦–å±å›¾ç‰‡

### 3. ä»£ç ä¼˜åŒ–
- å‡å°‘ä¸å¿…è¦çš„ setData
- é¿å…é¢‘ç¹çš„ DOM æ“ä½œ
- ä½¿ç”¨èŠ‚æµ/é˜²æŠ–å¤„ç†é«˜é¢‘äº‹ä»¶

---

## ğŸ“ ä»£ç è§„èŒƒ

### å‘½åè§„èŒƒ
```javascript
// å˜é‡ï¼šå°é©¼å³°
const userName = 'å¼ ä¸‰';

// å¸¸é‡ï¼šå¤§å†™ä¸‹åˆ’çº¿
const MAX_LEVEL = 10;

// å‡½æ•°ï¼šå°é©¼å³°
function getUserInfo() {}

// ç±»ï¼šå¤§é©¼å³°
class GameLogic {}
```

### æ³¨é‡Šè§„èŒƒ
```javascript
/**
 * å‡½æ•°è¯´æ˜
 * @param {string} gameId - æ¸¸æˆID
 * @param {number} level - å…³å¡æ•°
 * @returns {Promise} è¿”å›å€¼è¯´æ˜
 */
function loadLevel(gameId, level) {}
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [åç«¯å¼€å‘æ–‡æ¡£](./åç«¯å¼€å‘æ–‡æ¡£.md)
- [äº§å“éœ€æ±‚æ–‡æ¡£](./äº§å“éœ€æ±‚æ–‡æ¡£.md)
- [ç§¯åˆ†è§„åˆ™æ–‡æ¡£](./ç§¯åˆ†è§„åˆ™æ–‡æ¡£.md)
